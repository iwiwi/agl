box: kenkoooo/compile-latex
build:
  steps:
    - script:
        name: prepare
        code: |
          export USER=hoge
          export UPLOAD_FOLDER=/akiba-lab
    - script:
        name: kdd16
        code: |
          cd kdd16/
          latexmk -C
          latexmk main
          cp main.pdf ${WERCKER_REPORT_ARTIFACTS_DIR}/kdd16.pdf
          filename=kdd16.pdf
          token=lwQg7SpB-j0AAAAAAAA9TDUUb_MuCebF_ALfUFrX0Q8Id9o0mRGpSWJSf10A38VI
          curl --fail -X POST https://content.dropboxapi.com/2/files/upload \
              --header "Authorization: Bearer $token" \
              --header "Dropbox-API-Arg: {\"path\": \"$UPLOAD_FOLDER/$filename\",\"mode\": \"overwrite\",\"autorename\": true,\"mute\": false}" \
              --header "Content-Type: application/octet-stream" \
              --data-binary @main.pdf \
              || exit 1
          cd ../
    - script:
        name: jsai16
        code: |
          cd jsai16/
          latexmk -C
          latexmk -shell-escape -f main
          cp main.pdf ${WERCKER_REPORT_ARTIFACTS_DIR}/jsai16.pdf
          filename=jsai.pdf
          token=lwQg7SpB-j0AAAAAAAA9TDUUb_MuCebF_ALfUFrX0Q8Id9o0mRGpSWJSf10A38VI
          curl --fail -X POST https://content.dropboxapi.com/2/files/upload \
              --header "Authorization: Bearer $token" \
              --header "Dropbox-API-Arg: {\"path\": \"$UPLOAD_FOLDER/$filename\",\"mode\": \"overwrite\",\"autorename\": true,\"mute\": false}" \
              --header "Content-Type: application/octet-stream" \
              --data-binary @main.pdf \
              || exit 1
          cd ../
