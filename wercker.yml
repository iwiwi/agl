box: bendiken/cxx14@0.0.8
build:
  steps:
    - script:
        name: install
        code: |
          sudo apt-get update
          sudo apt-get install -y cmake curl graphviz
          curl https://codeload.github.com/gflags/gflags/tar.gz/v2.1.2 -o v2.1.2.tar.gz
          tar zxvf v2.1.2.tar.gz
          cd gflags-2.1.2
          cmake .
          make -j
          sudo make install
    - script:
        name: build-gcc
        code: |
          make clean
          CXX=g++ make all
    - script:
        name: test-gcc
        code: |
          bin/test_all
    - script:
        name: build-clang
        code: |
          make clean
          CXX=clang make all
    - script:
        name: test-clang
        code: |
          bin/test_all
    - script:
        name: doxygen
        code: |
          doxygen

deploy:
  steps:
    - script:
        name: install
        code: |
          sudo apt-get update
          sudo apt-get install -y curl zip unzip
    - script:
        name: preparation
        code: |
          curl https://codeload.github.com/nulltask/heroku-static-provider/zip/master -o heroku-static-provider-master.zip
          unzip -o heroku-static-provider-master.zip
          cp -r html/* heroku-static-provider-master/public/
    - heroku-deploy:
        # cwd: heroku-static-provider-master/
        source_dir: heroku-static-provider-master/
        key-name: default_ssh_key